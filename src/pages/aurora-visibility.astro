---
/**
 * Aurora Visibility UK Tonight
 * SEO landing page targeting fastest-growing keywords (YoY +9900%):
 * - "aurora borealis visibility tonight"
 * - "aurora visibility tonight"
 * - "see aurora borealis tonight"
 * - "viewing aurora borealis tonight"
 */
import BaseLayout from "../layouts/BaseLayout.astro";
import "../styles/pages/homepage-uk.css";
import LiveForecastBar from "../components/LiveForecastBar.astro";
import CitySearch from "../components/CitySearch.astro";
import FAQ from "../components/FAQ.astro";
import StoreBadges from "../components/StoreBadges.astro";
import citiesData from "../data/site-cities";
import { calculateKpThreshold, formatKpThreshold } from "../utils/kp-bands";

const cityBySlug = new Map(citiesData.map((city) => [city.slug, city]));

// Cities sorted by magnetic latitude (best visibility first)
const citiesByVisibility = [...citiesData]
  .filter(c => c.magneticLat)
  .sort((a, b) => (b.magneticLat || 0) - (a.magneticLat || 0))
  .slice(0, 12);

const locationCount = citiesData.length;

// Get current month for "tonight" context
const currentMonth = new Date().toLocaleString('en-GB', { month: 'long' });

// FAQ schema targeting visibility queries - 12 questions for comprehensive coverage
const faqItems = [
  {
    question: "Can I see aurora borealis tonight in UK?",
    answer: "Check our live visibility map above showing current Kp index and cloud cover. Aurora borealis is visible in Scotland when Kp reaches 3-4, Northern England at Kp 5-6, and Southern England during rare Kp 7+ events."
  },
  {
    question: "What time is aurora borealis visible tonight?",
    answer: "Aurora borealis is best visible between 10 PM and 2 AM when skies are darkest. Our live tracker shows the optimal viewing window for your location based on sunset, moonrise, and current geomagnetic activity."
  },
  {
    question: "Where can I see aurora borealis tonight in UK?",
    answer: "Tonight's best aurora borealis visibility is in Scotland's northern islands (Shetland, Orkney) and Highlands. During stronger storms (Kp 5+), visibility extends to Northern Ireland, Newcastle, and occasionally Yorkshire."
  },
  {
    question: "How do I check aurora borealis visibility?",
    answer: "Use our live visibility tracker showing real-time Kp index, cloud cover percentage, moon phase, and darkness window. Green status means good visibility; amber means possible; red means unlikely for your location."
  },
  {
    question: "What affects aurora borealis visibility?",
    answer: "Four factors determine visibility: (1) Kp index must reach your location's threshold, (2) Cloud cover below 30%, (3) No moonlight interference, (4) Full astronomical darkness. All factors shown in our forecast."
  },
  {
    question: "How far south can aurora borealis be visible in UK?",
    answer: "During extreme geomagnetic storms (Kp 8-9), aurora borealis can be visible as far south as Cornwall and Kent. The May 2024 storm was visible across all of UK. Such events occur 2-4 times per solar cycle maximum."
  },
  {
    question: "Do I need special equipment to see aurora borealis?",
    answer: "No special equipment needed - aurora borealis is visible to the naked eye. However, binoculars can enhance detail, and cameras capture colours better than human eyes. A red torch preserves night vision while checking your phone."
  },
  {
    question: "Why can't I see aurora borealis when the forecast says it's active?",
    answer: "Common reasons include: local cloud cover blocking the view, light pollution from nearby towns, looking in the wrong direction (aurora appears north), or the activity subsiding before reaching your location. Our app shows real-time updates."
  },
  {
    question: "Can aurora borealis be visible during twilight?",
    answer: "Aurora borealis requires full darkness for visibility. Astronomical twilight (sun 18° below horizon) offers the best conditions. Summer months in UK have limited darkness, making September-March the prime aurora season."
  },
  {
    question: "What does aurora borealis look like to the naked eye?",
    answer: "To the naked eye, aurora borealis often appears as a pale green or white glow on the northern horizon. Brighter displays show distinct curtains, arcs, and pillars. Cameras capture more vivid colours due to longer exposure times."
  },
  {
    question: "How quickly does aurora borealis visibility change?",
    answer: "Aurora visibility can change within minutes. A quiet sky can suddenly burst with activity, or a bright display can fade rapidly. Our app provides real-time alerts so you don't miss sudden visibility windows."
  },
  {
    question: "Is aurora borealis visible through clouds?",
    answer: "No, aurora borealis requires clear skies. Even thin high clouds significantly reduce visibility. Our forecast includes Met Office cloud cover predictions to help you find clear sky windows for aurora viewing."
  }
];

const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqItems.map(item => ({
    "@type": "Question",
    "name": item.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": item.answer
    }
  }))
};
---

<BaseLayout
  title="Aurora Borealis Visibility Tonight UK | Can I See Northern Lights?"
  description="Check aurora borealis visibility tonight in UK. Live visibility map showing where you can see northern lights now. Real-time Kp index, cloud cover, best viewing times."
  canonical="https://auroraforecast.uk/aurora-visibility"
>
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

  <LiveForecastBar />

  <main class="home-uk">
    <!-- Hero Section -->
    <section class="home-uk__intro">
      <div class="container">
        <h1 class="home-uk__title">Aurora Borealis Visibility Tonight</h1>
        <p class="home-uk__subtitle">
          Can you see northern lights tonight in UK? Check live visibility conditions
          for {locationCount} locations with real-time Kp index and cloud cover.
        </p>
      </div>
    </section>

    <!-- Quick Visibility Check -->
    <section class="home-uk__search-section">
      <div class="container">
        <div class="home-uk__section-heading">
          <h2>Check Visibility at Your Location</h2>
          <p>Enter your city to see if aurora borealis is visible tonight.</p>
        </div>

        <div class="home-uk__planner-grid">
          <article class="planner-card planner-card--featured">
            <h3>Is Aurora Borealis Visible Tonight?</h3>
            <p>Search your location for instant visibility status.</p>
            <CitySearch id="visibility-search" compact={true} />
            <p class="home-uk__small">We'll show current Kp, clouds, and your visibility chances.</p>
          </article>

          <article class="planner-card">
            <h3>Visibility Factors Tonight</h3>
            <ul class="home-uk__checklist">
              <li><strong>Kp Index:</strong> Check live value above</li>
              <li><strong>Cloud Cover:</strong> Lower is better (&lt;30%)</li>
              <li><strong>Moon Phase:</strong> New moon = darkest skies</li>
              <li><strong>Darkness:</strong> After 10 PM best</li>
            </ul>
          </article>
        </div>
      </div>
    </section>

    <!-- Best Visibility Locations -->
    <section class="home-uk__visibility-ranking">
      <div class="container">
        <div class="home-uk__section-heading">
          <h2>Best Aurora Borealis Visibility in UK</h2>
          <p>Locations ranked by magnetic latitude (higher = easier to see aurora).</p>
        </div>

        <div class="visibility-grid">
          {citiesByVisibility.map((city, index) => {
            const kpNeeded = calculateKpThreshold(city.magneticLat);
            let visibilityClass = 'moderate';
            if (kpNeeded <= 3) visibilityClass = 'excellent';
            else if (kpNeeded <= 5) visibilityClass = 'good';
            return (
              <a href={`/${city.slug}`} class={`visibility-card visibility-card--${visibilityClass}`}>
                <span class="visibility-rank">#{index + 1}</span>
                <h3>{city.name}</h3>
                <div class="visibility-stats">
                  <span class="stat">Kp {formatKpThreshold(kpNeeded)}+</span>
                  <span class="stat">{city.magneticLat?.toFixed(1)}° MLAT</span>
                </div>
              </a>
            );
          })}
        </div>

        <p class="home-uk__note">
          <a href="/aurora-tracker">View live visibility map</a> showing current conditions across all UK.
        </p>
      </div>
    </section>

    <!-- When to See Aurora -->
    <section class="home-uk__timing">
      <div class="container">
        <div class="home-uk__section-heading">
          <h2>When is Aurora Borealis Visible in {currentMonth}?</h2>
          <p>Best viewing times and seasonal patterns for UK.</p>
        </div>

        <div class="home-uk__factors-grid">
          <article class="factor-card">
            <h3>Best Hours</h3>
            <p><strong>10 PM - 2 AM</strong> local time offers darkest skies. Aurora can appear anytime during darkness but peaks around midnight.</p>
          </article>
          <article class="factor-card">
            <h3>Best Months</h3>
            <p><strong>September - March</strong> when nights are longest. October and March around equinoxes often show increased activity.</p>
          </article>
          <article class="factor-card">
            <h3>Best Conditions</h3>
            <p><strong>Clear, moonless nights</strong> away from city lights. Check our forecast for cloud-free windows tonight.</p>
          </article>
          <article class="factor-card">
            <h3>Current Cycle</h3>
            <p><strong>Solar Cycle 25</strong> is near maximum (2024-2025), meaning more frequent and stronger aurora displays than average years.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="home-uk__faq">
      <div class="container">
        <div class="home-uk__section-heading">
          <h2>Aurora Visibility FAQ</h2>
        </div>
        <FAQ items={faqItems} />
      </div>
    </section>

    <!-- Related Pages -->
    <section class="home-uk__related">
      <div class="container">
        <div class="home-uk__section-heading">
          <h2>Explore More Aurora Resources</h2>
        </div>
        <div class="related-grid">
          <a href="/aurora-borealis-forecast" class="related-card">
            <h3>Aurora Borealis Forecast</h3>
            <p>Detailed aurora borealis prediction with Kp thresholds by region.</p>
          </a>
          <a href="/aurora-tracker" class="related-card">
            <h3>Live Aurora Map</h3>
            <p>Real-time aurora borealis tracker with Kp index and cloud cover.</p>
          </a>
          <a href="/" class="related-card">
            <h3>UK Aurora Forecast</h3>
            <p>Complete aurora borealis forecast for all UK locations.</p>
          </a>
        </div>
      </div>
    </section>

    <!-- App CTA -->
    <section class="home-uk__app-cta">
      <div class="container">
        <div class="home-uk__section-heading">
          <h2>Get Visibility Alerts</h2>
          <p>Instant notifications when aurora borealis becomes visible at your location.</p>
        </div>
        <StoreBadges />
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  .home-uk__title {
    font-size: clamp(1.75rem, 5vw, 2.5rem);
    font-weight: 700;
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .home-uk__subtitle {
    text-align: center;
    color: var(--text-secondary, #666);
    max-width: 600px;
    margin: 0 auto 2rem;
  }

  .home-uk__checklist {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .home-uk__checklist li {
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color, #e5e5e5);
  }

  .home-uk__checklist li:last-child {
    border-bottom: none;
  }

  .visibility-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
  }

  .visibility-card {
    display: block;
    padding: 1rem;
    border-radius: 8px;
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s, box-shadow 0.2s;
    position: relative;
  }

  .visibility-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .visibility-card--excellent {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
  }

  .visibility-card--good {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
  }

  .visibility-card--moderate {
    background: var(--bg-secondary, #f5f5f5);
  }

  .visibility-rank {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    font-size: 0.75rem;
    opacity: 0.8;
  }

  .visibility-card h3 {
    font-size: 1rem;
    margin: 0 0 0.5rem 0;
  }

  .visibility-stats {
    display: flex;
    gap: 0.75rem;
    font-size: 0.85rem;
  }

  .visibility-card--excellent .visibility-stats,
  .visibility-card--good .visibility-stats {
    opacity: 0.9;
  }

  .planner-card--featured {
    background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
    color: white;
  }

  .planner-card--featured p {
    color: rgba(255,255,255,0.8);
  }

  .home-uk__factors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .factor-card {
    background: var(--bg-secondary, #f8f9fa);
    padding: 1.25rem;
    border-radius: 8px;
  }

  .factor-card h3 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
  }

  .factor-card p {
    font-size: 0.9rem;
    color: var(--text-secondary, #666);
    margin: 0;
  }

  .home-uk__note {
    text-align: center;
    margin-top: 1.5rem;
  }

  .home-uk__note a {
    color: var(--link-color, #0066cc);
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .related-card {
    display: block;
    padding: 1.25rem;
    background: var(--bg-secondary, #f8f9fa);
    border-radius: 8px;
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .related-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .related-card h3 {
    font-size: 1.1rem;
    margin: 0 0 0.5rem 0;
    color: var(--link-color, #0066cc);
  }

  .related-card p {
    font-size: 0.9rem;
    color: var(--text-secondary, #666);
    margin: 0;
  }
</style>
